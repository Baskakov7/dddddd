<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dom Veka — Современные дома в ЛО и СПб</title>
<meta name="description" content="Dom Veka — строительство современных домов в Ленинградской области и Санкт-Петербурге. Индивидуальные проекты, высокое качество, разумные цены." />
<meta name="author" content="Dom Veka" />
<!-- Цвет системы под темы -->
<meta name="theme-color" content="#f3f4f6" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0e1524" media="(prefers-color-scheme: dark)">
<meta id="dynamic-theme-color" name="theme-color" content="#f3f4f6">
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<!-- Шрифты -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" media="all" />
<link rel="canonical" href="https://ваш-сайт.github.io/" />
<!-- Open Graph / Twitter -->
<meta property="og:title" content="Dom Veka — Современные дома в ЛО и СПб" />
<meta property="og:description" content="Индивидуальные проекты домов. Качество, стиль, комфорт." />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://ваш-сайт.github.io/house1.jpg" />
<meta property="og:url" content="https://ваш-сайт.github.io/" />
<meta property="og:site_name" content="Dom Veka" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Dom Veka — Современные дома в ЛО и СПб" />
<meta name="twitter:description" content="Индивидуальные проекты, высокое качество, разумные цены." />
<meta name="twitter:image" content="https://ваш-сайт.github.io/house1.jpg" />
<!-- JSON-LD -->
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "Organization",
"name": "Dom Veka",
"url": "https://ваш-сайт.github.io/",
"logo": "https://ваш-сайт.github.io/logo.png",
"email": "info@domveka.ru",
"telephone": "+7-812-123-45-67",
"address": {
"@type": "PostalAddress",
"addressLocality": "Санкт-Петербург",
"addressRegion": "Ленинградская область",
"addressCountry": "RU"
}
}
</script>
<script type="application/ld+json">
{
"@context":"https://schema.org",
"@type":"WebSite",
"name":"Dom Veka",
"url":"https://ваш-сайт.github.io/",
"potentialAction":{
"@type":"SearchAction",
"target":"https://ваш-сайт.github.io/?q={search_term_string}",
"query-input":"required name=search_term_string"
}
}
</script>
<script type="application/ld+json">
{
"@context":"https://schema.org",
"@graph":[
{
"@type":"Product",
"name":"Проект 46",
"category":"Дом",
"brand":{"@type":"Brand","name":"Dom Veka"},
"url":"https://ваш-сайт.github.io/#p1",
"image":"https://ваш-сайт.github.io/house1.jpg",
"description":"Одноэтажный современный дом, 180 м²: 4 спальни (включая мастер-спальню), кухня-гостиная с выходом на террасу, 3 санузла. Цена от 30 000 000 ₽; зависит от участка.",
"offers":{"@type":"AggregateOffer","priceCurrency":"RUB","lowPrice":"30000000","highPrice":"48000000","availability":"https://schema.org/InStock"}
},
{
"@type":"Product",
"name":"Проект 180",
"category":"Дом",
"brand":{"@type":"Brand","name":"Dom Veka"},
"url":"https://ваш-сайт.github.io/#p2",
"image":"https://ваш-сайт.github.io/house2.jpg",
"description":"Одноэтажный дом из газобетона, 135 м²: 3 спальни (включая мастер-спальню), кухня-гостиная с выходом на террасу, панорамные окна, 2 санузла.",
"offers":{"@type":"AggregateOffer","priceCurrency":"RUB","lowPrice":"20000000","highPrice":"28000000","availability":"https://schema.org/InStock"}
},
{
"@type":"Product",
"name":"Проект 175",
"category":"Дом",
"brand":{"@type":"Brand","name":"Dom Veka"},
"url":"https://ваш-сайт.github.io/#p3",
"image":"https://ваш-сайт.github.io/house3.jpg",
"description":"Одноэтажный дом из газобетона в современном стиле. 200 м²: кухня-гостиная с выходом на террасу, мастер-спальня, всего 3 спальни и 3 санузла.",
"offers":{"@type":"AggregateOffer","priceCurrency":"RUB","lowPrice":"30000000","highPrice":"38000000","availability":"https://schema.org/InStock"}
},
{
"@type":"Product",
"name":"Проект Полевая",
"category":"Дом",
"brand":{"@type":"Brand","name":"Dom Veka"},
"url":"https://ваш-сайт.github.io/#p4",
"image":"https://ваш-сайт.github.io/polevaya1.jpg",
"description":"Одноэтажный дом из газобетона в современном стиле, 150 м². 3 спальни, мастер-спальня, 2 санузла, кухня-гостиная, терраса. Стоимость без отделки от 15 млн ₽; бюджет зависит от участка (деревня Дранишники).",
"offers":{"@type":"AggregateOffer","priceCurrency":"RUB","lowPrice":"15000000","availability":"https://schema.org/InStock"}
},
{
"@type":"Product",
"name":"Проект 32",
"category":"Дом",
"brand":{"@type":"Brand","name":"Dom Veka"},
"url":"https://ваш-сайт.github.io/#p5",
"image":"https://ваш-сайт.github.io/p32_1.jpg",
"description":"Двухэтажный дом из газобетона в современном стиле, 250 м². 7 спален, мастер-спальня, 3 санузла, кухня-гостиная, терраса.",
"offers":{"@type":"AggregateOffer","priceCurrency":"RUB","lowPrice":"25000000","availability":"https://schema.org/InStock"}
},
{
"@type":"Product",
"name":"Проект Скандинавия",
"category":"Дом",
"brand":{"@type":"Brand","name":"Dom Veka"},
"url":"https://ваш-сайт.github.io/#p6",
"image":"https://ваш-сайт.github.io/skandi1.jpg",
"description":"Двухэтажный дом из газобетона в современном стиле, 135 м². 3 спальни (включая мастер-спальню), 2 санузла, кухня-гостиная, терраса. Дранишники, 8 соток. Бюджет без отделки от 15 000 000 ₽; цена зависит от участка.",
"offers":{"@type":"AggregateOffer","priceCurrency":"RUB","lowPrice":"15000000","availability":"https://schema.org/InStock"}
}
]
}
</script>
<style>
/* ==========================
Пастельная палитра + акценты
========================== */
:root{
/* Светлая тема — «Сканди-небо» */
--bg:#f3f4f6;
--text:#2f3441;
--muted:#6b7280;
--card:#ffffff;
--border:#e5e7eb;
--accent:#9bb8d3;
--accent-contrast:#0e2238;
--focus:#b7d5ea;
--shadow:rgba(20, 28, 40, .12);
--shadow-soft:0 8px 24px rgba(20,28,40,.10);
--hero-overlay:linear-gradient(180deg, rgba(20,28,40,.45), rgba(20,28,40,.24), rgba(20,28,40,0));
--nav-bg:rgba(255,255,255,.82);
--safe-bottom:env(safe-area-inset-bottom, 0px);
--theme-color:#f3f4f6;
/* Тонированный фон секций */
--section-bg: color-mix(in srgb, var(--card) 92%, var(--accent) 8%);
--section-ring: color-mix(in srgb, var(--border) 70%, var(--accent) 30%);
}
@media (prefers-color-scheme: dark){
:root{
/* Тёмная пастель */
--bg:#0e1524;
--text:#e8edf4;
--muted:#a7b1c2;
--card:#121a2c;
--border:#1f2a3b; /* fixed typo */
--accent:#a7c7e7;
--accent-contrast:#0b1422;
--focus:#bcd8ee;
--shadow:rgba(0,0,0,.35);
--shadow-soft:0 10px 28px rgba(0,0,0,.28);
--hero-overlay:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.32), rgba(0,0,0,.08));
--nav-bg:rgba(18,26,44,.72);
--theme-color:#0e1524;
--section-bg: color-mix(in srgb, var(--card) 86%, var(--accent) 14%);
--section-ring: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
}
}
/* Принудительное управление темой */
[data-theme="light"]{
--bg:#f3f4f6; --text:#2f3441; --muted:#6b7280; --card:#fff; --border:#e5e7eb;
--accent:#9bb8d3; --accent-contrast:#0e2238; --shadow:rgba(20, 28, 40, .12);
--focus:#b7d5ea; --hero-overlay:linear-gradient(180deg, rgba(20,28,40,.46), rgba(20,28,40,.24), rgba(20,28,40,0));
--nav-bg:rgba(255,255,255,.86); --theme-color:#f3f4f6; --shadow-soft:0 8px 24px rgba(20,28,40,.10);
--section-bg: color-mix(in srgb, var(--card) 92%, var(--accent) 8%);
--section-ring: color-mix(in srgb, var(--border) 70%, var(--accent) 30%);
}
[data-theme="dark"]{
--bg:#0e1524; --text:#e8edf4; --muted:#a7b1c2; --card:#121a2c; --border:#1f2a3b;
--accent:#a7c7e7; --accent-contrast:#0b1422; --shadow:rgba(0,0,0,.35);
--focus:#bcd8ee; --hero-overlay:linear-gradient(180deg, rgba(0,0,0,.58), rgba(0,0,0,.34), rgba(0,0,0,.08));
--nav-bg:rgba(18,26,44,.74); --theme-color:#0e1524; --shadow-soft:0 10px 28px rgba(0,0,0,.28);
--section-bg: color-mix(in srgb, var(--card) 86%, var(--accent) 14%);
--section-ring: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
}
/* Базовая типографика и фон */
html{scroll-behavior:smooth;}
@media (prefers-reduced-motion: reduce){ html{scroll-behavior:auto;} *{animation:none !important;transition:none !important;} }
body{
margin:0; font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
background:var(--bg); color:var(--text); line-height:1.6; color-scheme:light dark;
}
/* Ссылки и фокус */
a{color:inherit; text-decoration:none;}
a:hover{text-decoration:underline; text-underline-offset:2px;}
a:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{
outline:2px solid var(--focus); outline-offset:3px; border-radius:6px;
}
/* Вспомогательное */
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
.progress{
position:fixed;top:0;left:0;height:3px;width:100%;
background:linear-gradient(90deg, color-mix(in srgb, var(--accent) 90%, #10b981 10%), color-mix(in srgb, var(--accent) 80%, #22d3ee 20%), color-mix(in srgb, var(--accent) 70%, #10b981 30%));
transform-origin:0 0; transform:scaleX(0); z-index:9999;
}
/* Хиро */
header.hero{
position:relative;overflow:hidden;color:#fff;text-align:center;
min-height:clamp(360px,60vh,720px);display:grid;place-items:center;
}
header.hero::before{content:"";position:absolute;inset:0;background:var(--hero-overlay);z-index:1;}
.hero-media{position:absolute;inset:0;z-index:0;}
.hero-media img{width:100%;height:100%;object-fit:cover;filter:saturate(1.02) contrast(1.02) brightness(0.9);transform:scale(1.03);}
.hero-content{position:relative;z-index:2;padding:clamp(24px,4vw,48px) 20px;}
h1{font-size:clamp(1.8rem,4.2vw,2.8rem);margin:0 0 8px;}
.tagline{font-size:clamp(1rem,2.2vw,1.2rem);margin:0 0 16px;color:#f0f3f6;}
header .theme-toggle{
position:absolute;right:16px;top:16px;background:var(--accent);color:var(--accent-contrast);
border:none;padding:10px 12px;border-radius:24px;cursor:pointer;font-weight:600;box-shadow:0 2px 10px var(--shadow);z-index:2;
}
header .theme-toggle[aria-pressed="true"]{filter:brightness(.98);}
/* Логотип */
.brand-logo{display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:18px;
background: color-mix(in srgb, #000 10%, transparent);backdrop-filter:saturate(1.1) blur(2px);
box-shadow:0 6px 20px rgba(0,0,0,.18);margin-bottom:10px;transform:translateY(0);
transition:transform .25s ease, box-shadow .25s ease, background .25s ease;animation:logo-pop .55s cubic-bezier(.2,.7,.2,1) .12s both;
}
.brand-logo:hover{transform:translateY(-2px); box-shadow:0 10px 26px rgba(0,0,0,.22);}
.logo-img{width:clamp(140px, 28vw, 240px);height:auto;display:block;border-radius:14px;
filter:drop-shadow(0 8px 18px rgba(0,0,0,.20));transition:transform .25s ease, filter .25s ease;
}
.brand-logo:hover .logo-img{transform:scale(1.02); filter:saturate(1.04) drop-shadow(0 10px 22px rgba(0,0,0,.24));}
/* Навигация */
nav{
background:var(--nav-bg); border-bottom:1px solid var(--border);
position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.1) blur(10px);
transition:transform .28s ease, background .2s ease;
}
nav.nav-hidden{transform:translateY(-110%);}
nav ul{display:flex;justify-content:center;flex-wrap:wrap;list-style:none;margin:0;padding:10px;gap:10px 18px;}
nav ul li a{font-weight:600;padding:6px 10px;border-radius:8px;}
nav ul li a:hover{background:color-mix(in srgb, var(--card) 82%, var(--accent) 18%); text-decoration:none;}
/* Секции — «карточки» */
section{
padding:clamp(28px,4vw,48px) 20px; max-width:1100px; margin:16px auto;
content-visibility:auto; contain-intrinsic-size:600px;
background:var(--section-bg);
border:1px solid var(--section-ring);
border-radius:16px;
box-shadow: var(--shadow-soft);
}
h2{
font-size:clamp(1.3rem,3vw,1.8rem);margin-bottom:16px; position:relative;
padding-bottom:6px;
}
h2::after{
content:""; position:absolute; left:0; bottom:0; width:64px; height:4px;
background: color-mix(in srgb, var(--accent) 80%, var(--border) 20%);
border-radius:2px;
}
.subtle{color:var(--muted);}
/* Галерея и карточки */
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px;}
.gallery[role="list"] > article[role="listitem"]{list-style:none;}
.gallery.compact .card-img-wrap img.card-img{max-height:150px;}
@media (max-width:600px){ .gallery.compact .card-img-wrap img.card-img{max-height:130px;} }
.card{
background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;
box-shadow:0 2px 10px var(--shadow);transform-style:preserve-3d;transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.card:hover{
transform:translateY(-3px) perspective(800px) rotateX(1deg) rotateY(-1deg);
box-shadow:0 10px 26px var(--shadow);
border-color: color-mix(in srgb, var(--border) 60%, var(--accent) 40%);
}
/* Обёртка изображения + карусель */
.card-img-wrap{
position:relative;overflow:hidden;background:color-mix(in srgb, var(--card) 90%, var(--accent) 10%);
}
[data-theme="dark"] .card-img-wrap { background:#f4f1ee; }
@media (prefers-color-scheme: dark){
:root .card-img-wrap { background:#f4f1ee; }
}
.card-img{display:block;width:100%;height:auto;max-height:220px;object-fit:contain;object-position:center;background:transparent;transition:transform .25s ease;}
.card:hover .card-img{ transform:scale(1.04); }
.img-preview{display:block;cursor:zoom-in;}
/* Ручное листание карусели */
.card-nav-btn{
position:absolute; top:50%; transform:translateY(-50%);
background:rgba(0,0,0,.38); color:#fff; border:none; width:34px; height:34px; border-radius:999px;
display:grid; place-items:center; cursor:pointer; backdrop-filter:blur(4px);
box-shadow:0 4px 10px rgba(0,0,0,.22); padding:0;
}
.card-nav-btn:hover{ background:rgba(0,0,0,.58); }
.card-prev{ left:8px; }
.card-next{ right:8px; }
.card-idx{
position:absolute; bottom:8px; right:8px;
background:rgba(0,0,0,.38); color:#fff; font-size:.85em; padding:2px 8px; border-radius:10px;
}
/* Сетевые элементы */
.card-body{padding:16px;display:grid;gap:8px;}
.gallery.compact .card-body{padding:12px;gap:6px;}
.card-body .meta{display:flex;flex-wrap:wrap;gap:8px 12px;color:var(--muted);font-size:.95em;}
.dim{opacity:.32; filter:saturate(.85);}
/* Кнопки и формы */
.btn{
background:var(--accent);color:var(--accent-contrast);border:none;
padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;min-width:120px;text-align:center;
box-shadow:0 2px 8px var(--shadow); transition:transform .08s ease, box-shadow .18s ease, filter .18s ease;
}
.btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px var(--shadow);}
.btn.secondary{
background:transparent;color:var(--text);border:1px solid var(--section-ring);
}
.btn.secondary:hover{
background:color-mix(in srgb, var(--card) 86%, var(--accent) 14%);
border-color: color-mix(in srgb, var(--border) 40%, var(--accent) 60%);
}
.btn:disabled{opacity:.6;cursor:not-allowed;}
.toolbar{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 12px;}
/* Формы */
input,textarea,select{
width:100%;padding:12px;margin-top:10px;margin-bottom:14px;border:1px solid var(--border);border-radius:8px;
font-family:inherit;font-size:1em;background:var(--card);color:var(--text); box-shadow:0 1px 0 rgba(0,0,0,.02) inset;
}
label{font-weight:600;}
input[type="submit"],.submit{background:var(--accent);color:var(--accent-contrast);border:none;cursor:pointer;transition:transform .05s ease;}
input[type="submit"]:hover,.submit:hover{transform:translateY(-1px);}
input:invalid,textarea:invalid,select:invalid{border-color:#ef4444;}
input:valid,textarea:valid,select:valid{border-color:color-mix(in srgb, var(--border) 60%, var(--focus) 40%);}
#price,#mortgageResult,#keyRateStatus{font-weight:bold;}
/* Появление секций */
.fade-in{opacity:0;transform:translateY(20px);}
.fade-in.anim-shown{animation:fadeIn .8s ease-out forwards;}
@keyframes fadeIn{to{opacity:1;transform:translateY(0);}}
/* Эффекты */
.shake{animation:shake .28s ease;}
@keyframes shake{10%,90%{transform:translateX(-1px);}20%,80%{transform:translateX(2px);}30%,50%,70%{transform:translateX(-4px);}40%,60%{transform:translateX(4px);}}
/* Таблица сравнения */
.compare-table{width:100%;border-collapse:collapse;overflow:hidden;border-radius:12px;border:1px solid var(--border);}
.compare-table th,.compare-table td{border-bottom:1px solid var(--border);padding:12px;text-align:left;vertical-align:top;background:var(--card);}
.compare-table th{background:color-mix(in srgb, var(--card) 92%, var(--accent) 8%);font-weight:700;}
/* Toast */
.toast{
position:fixed;bottom:calc(20px + var(--safe-bottom));right:20px;background:var(--accent);color:var(--accent-contrast);
padding:10px 14px;border-radius:10px;box-shadow:0 4px 16px var(--shadow);opacity:0;transform:translateY(10px);transition:all .25s ease;z-index:1000;
}
.toast.show{opacity:1;transform:translateY(0);}
/* Back-to-top */
#backToTop{
position:fixed;right:18px;bottom:calc(84px + var(--safe-bottom));background:var(--accent);color:var(--accent-contrast);
border:none;padding:10px 12px;border-radius:999px;cursor:pointer;box-shadow:0 2px 10px var(--shadow);opacity:0;transform:translateY(10px);transition:all .2s ease;z-index:1000;
}
#backToTop.show{opacity:1;transform:translateY(0);}
/* Sticky CTA */
.sticky-cta{
position:sticky;bottom:0;z-index:9;background:color-mix(in srgb, var(--bg) 82%, var(--accent) 18%);
border-top:1px solid var(--section-ring);padding:10px 16px calc(10px + var(--safe-bottom));
display:flex;justify-content:center;gap:12px;backdrop-filter:saturate(1.1) blur(6px);
}
.sticky-cta .btn{ background:var(--accent); color:var(--accent-contrast); }
/* Футер */
footer{padding:20px;text-align:center;color:var(--muted);}
/* Карта */
.map-embed{width:100%;height:380px;border:0;border-radius:12px;}
/* Мини-диаграмма */
.chart-card{background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px;}
.chart-legend{display:flex; gap:12px; flex-wrap:wrap; margin-top:8px; font-size:.95em;}
.chart-legend span{display:inline-flex; align-items:center; gap:6px;}
.chart-legend i{display:inline-block; width:12px; height:12px; border-radius:3px;}
/* Модальное изображение */
#modalImg{
position:fixed; inset:0; z-index:9999; display:grid; place-items:center;
background:rgba(0,0,0,.85); padding:2vh; opacity:0; visibility:hidden;
transition:opacity .2s ease, visibility .2s ease;
}
#modalImg[aria-hidden="false"]{ opacity:1; visibility:visible; }
#modalImg__img{ max-width:90vw; max-height:90vh; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,.5); background:#111;}
[data-theme="dark"] #modalImg__img{ background:#f4f1ee; }
@media (prefers-color-scheme: dark){
:root #modalImg__img{ background:#f4f1ee; }
}
#modalImg__close{
position:absolute; top:14px; right:14px; background:rgba(255,255,255,.12);
color:#fff; border:0; border-radius:10px; padding:8px 10px; cursor:pointer; backdrop-filter:blur(4px);
}
/* Навигация в модалке */
#modalImg__prev,#modalImg__next{
position:absolute; top:50%; transform:translateY(-50%);
background:rgba(255,255,255,.14); color:#fff; border:0; width:40px; height:40px;
border-radius:999px; display:grid; place-items:center; cursor:pointer; backdrop-filter:blur(4px);
box-shadow:0 6px 20px rgba(0,0,0,.35);
}
#modalImg__prev{ left:16px; }
#modalImg__next{ right:16px; }
#modalImg__prev:hover,#modalImg__next:hover{ background:rgba(255,255,255,.22); }
#modalImg__idx{
position:absolute; bottom:16px; right:16px; background:rgba(255,255,255,.14); color:#fff;
font-size:.95em; padding:4px 10px; border-radius:10px; backdrop-filter:blur(4px);
}
/* Safari checkbox alignment fix for "Сравнить" */
.compareCheck{
width:16px; height:16px; margin:0; flex:0 0 auto; vertical-align:middle;
accent-color: currentColor;
}
@supports (-webkit-touch-callout: none){
.compareCheck{ transform: translateY(0.5px); }
}
/* Печать */
@media print{
header,nav,#toast,#backToTop,.theme-toggle,.sticky-cta{display:none !important;}
section{padding:0; background:#fff; border:0; box-shadow:none;}
a::after{content:" (" attr(href) ")";font-size:.9em;color:#555;}
}
</style>
</head>
<body>
  <a href="#about" class="sr-only">Перейти к содержимому</a>
  <div class="progress" id="progress"></div>

  <header class="hero">
    <button class="theme-toggle" id="themeToggle" aria-label="Переключить тему" aria-pressed="false" title="Сменить тему">🌗 Тема</button>
    <div class="hero-media" aria-hidden="true">
      <img src="house1.jpg" alt="" width="1600" height="1000" loading="eager" fetchpriority="high" decoding="async" />
    </div>
    <div class="hero-content">
      <div class="brand-logo">
        <img src="logo.png" class="logo-img" alt="Dom Veka" width="220" height="80" decoding="async" />
      </div>
      <h1>Dom Veka</h1>
      <p class="tagline">Современные дома в Ленинградской области и Санкт-Петербурге</p>
      <div class="hero-cta">
        <a href="#gallery" class="btn">Посмотреть проекты</a>
        <a href="#contact" class="btn">Получить консультацию</a>
      </div>
    </div>
  </header>

  <nav aria-label="Основная навигация" id="mainNav">
    <ul>
      <li><a href="#about">О компании</a></li>
      <li><a href="#gallery">Проекты</a></li>
      <li><a href="#compare">Сравнение</a></li>
      <li><a href="#calculator">Калькулятор</a></li>
      <li><a href="#mortgage">Ипотека</a></li>
      <li><a href="#qa">Районы</a></li>
      <li><a href="#contact">Связь</a></li>
    </ul>
  </nav>

  <section id="about" class="fade-in">
    <h2>О компании</h2>
    <p>Dom Veka — команда профессионалов, специализирующихся на строительстве домов стоимостью от 15 до 50 млн ₽. Мы создаём комфортные, энергоэффективные и стильные дома, учитывая индивидуальные пожелания каждого клиента. Работаем в ЛО и СПб, соблюдаем сроки и гарантируем качество.</p>
    <p class="subtle">Верифицированные подрядчики • Фиксируем сроки • Прозрачная смета • Гарантия до 5 лет</p>
  </section>

  <section id="gallery" class="fade-in" aria-labelledby="projects-heading">
    <h2 id="projects-heading">Галерея проектов</h2>

    <div class="toolbar">
      <button class="btn" id="filterBrick" type="button">Кирпичные дома</button>
      <button class="btn" id="filterAac" type="button">Газобетонные дома</button>
      <button class="btn secondary" id="resetFilter" type="button">Сбросить фильтр</button>
      <button class="btn secondary" id="viewComfort" type="button" title="Стандартный вид">Стандартный</button>
      <button class="btn secondary" id="viewCompact" type="button" title="Компактный вид">Компактный</button>
    </div>

    <div class="subtle" style="margin-bottom:12px;">Выберите до 2 проектов для сравнения</div>

    <div class="gallery" id="projectsGrid" role="list">
      <!-- Проект 1 (обновлён: 4 фото, 180 м², 4 спальни, 3 санузла, от 30 млн ₽; зависит от участка) -->
      <article class="card" data-id="p1" role="listitem" id="p1" data-images="house1.jpg,house1_2.jpg,house1_3.jpg,house1_4.jpg">
        <div class="card-img-wrap" tabindex="0" aria-label="Галерея изображений проекта Проект 46">
          <a href="house1.jpg" class="img-preview">
            <img src="house1.jpg" alt="Проект «46» — современный одноэтажный кирпичный дом" width="1200" height="800" loading="lazy" decoding="async" class="card-img" />
          </a>
          <button class="card-nav-btn card-prev" type="button" aria-label="Предыдущее фото">‹</button>
          <button class="card-nav-btn card-next" type="button" aria-label="Следующее фото">›</button>
          <div class="card-idx" aria-hidden="true">1/4</div>
        </div>
        <div class="card-body">
          <h3 style="margin:0;">Проект 46</h3>
          <div class="meta">
            <span>Кирпичный</span><span>180 м²</span><span>4 спальни</span>
          </div>
          <div class="subtle">От <strong data-price="p1">—</strong> <span class="dim">(зависит от участка)</span></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <label class="btn secondary" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" class="compareCheck" data-id="p1" aria-label="Сравнить проект 46" /> Сравнить
            </label>
            <button class="btn" data-gen="p1" aria-controls="desc-p1">Сгенерировать описание</button>
            <button class="btn secondary" data-share="p1" aria-label="Поделиться проектом 46" title="Поделиться">Поделиться</button>
          </div>
          <p class="subtle" id="desc-p1" style="margin:8px 0 0;" aria-live="polite">
            Проект 46 — одноэтажный современный дом площадью 180 м². 4 спальни, включая мастер‑спальню; кухня‑гостиная с выходом на террасу; всего 3 санузла. Чистая архитектура и комфорт на одном уровне. Стоимость от 30 000 000 ₽; итоговая цена зависит от участка.
          </p>
        </div>
      </article>

      <!-- Проект 2 (обновлён: 4 фото, имя «Проект 180», 135 м², 3 спальни, 2 санузла, одноэтажный, панорамные окна) -->
      <article class="card" data-id="p2" role="listitem" id="p2" data-images="house2.jpg,house2_2.jpg,house2_3.jpg,house2_4.jpg">
        <div class="card-img-wrap" tabindex="0" aria-label="Галерея изображений проекта Проект 180">
          <a href="house2.jpg" class="img-preview">
            <img src="house2.jpg" alt="Проект «180» — одноэтажный современный газобетонный дом" width="1200" height="800" loading="lazy" decoding="async" class="card-img" />
          </a>
          <button class="card-nav-btn card-prev" type="button" aria-label="Предыдущее фото">‹</button>
          <button class="card-nav-btn card-next" type="button" aria-label="Следующее фото">›</button>
          <div class="card-idx" aria-hidden="true">1/4</div>
        </div>
        <div class="card-body">
          <h3 style="margin:0;">Проект 180</h3>
          <div class="meta">
            <span>Газобетонный</span><span>135 м²</span><span>3 спальни</span>
          </div>
          <div class="subtle">От <strong data-price="p2">—</strong></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <label class="btn secondary" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" class="compareCheck" data-id="p2" aria-label="Сравнить проект 180" /> Сравнить
            </label>
            <button class="btn" data-gen="p2" aria-controls="desc-p2">Сгенерировать описание</button>
            <button class="btn secondary" data-share="p2" aria-label="Поделиться проектом 180" title="Поделиться">Поделиться</button>
          </div>
          <p class="subtle" id="desc-p2" style="margin:8px 0 0;" aria-live="polite">
            Проект 180 — одноэтажный дом площадью 135 м². 3 спальни (включая мастер‑спальню), кухня‑гостиная с выходом на террасу, панорамные окна и 2 санузла. Лаконичный современный стиль и максимум дневного света.
          </p>
        </div>
      </article>

      <!-- Проект 3 — «175» -->
      <article class="card" data-id="p3" role="listitem" id="p3" data-images="house3.jpg,house3_2.jpg,house3_3.jpg,house3_4.jpg,house3_5.jpg">
        <div class="card-img-wrap" tabindex="0" aria-label="Галерея изображений проекта Проект 175">
          <a href="house3.jpg" class="img-preview">
            <img src="house3.jpg" alt="Проект «175» — одноэтажный современный дом из газобетона" width="1200" height="800" loading="lazy" decoding="async" class="card-img" />
          </a>
          <button class="card-nav-btn card-prev" type="button" aria-label="Предыдущее фото">‹</button>
          <button class="card-nav-btn card-next" type="button" aria-label="Следующее фото">›</button>
          <div class="card-idx" aria-hidden="true">1/5</div>
        </div>
        <div class="card-body">
          <h3 style="margin:0;">Проект 175</h3>
          <div class="meta">
            <span>Газобетонный</span><span>200 м²</span><span>3 спальни</span>
          </div>
          <div class="subtle">От <strong data-price="p3">—</strong> <span class="dim">(без отделки)</span></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <label class="btn secondary" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" class="compareCheck" data-id="p3" aria-label="Сравнить проект 175" /> Сравнить
            </label>
            <button class="btn" data-gen="p3" aria-controls="desc-p3">Сгенерировать описание</button>
            <button class="btn secondary" data-share="p3" aria-label="Поделиться проектом 175" title="Поделиться">Поделиться</button>
          </div>
          <p class="subtle" id="desc-p3" style="margin:8px 0 0;" aria-live="polite">
            175 — одноэтажный дом из газобетона в современном стиле. 200 м² грамотно организованного пространства: просторная кухнягостиная с выходом на террасу, мастерспальня с собственным санузлом и местом под гардеробную, ещё две спальни для семьи или гостей. Всего 3 санузла, чистые линии фасадов и большие окна — комфортная жизнь на одном уровне с акцентом на свет и воздух.
          </p>
        </div>
      </article>

      <!-- Проект 4 — «Полевая» -->
      <article class="card" data-id="p4" role="listitem" id="p4" data-images="polevaya1.jpg,polevaya2.jpg,polevaya3.jpg,polevaya4.jpg,polevaya5.jpg">
        <div class="card-img-wrap" tabindex="0" aria-label="Галерея изображений проекта Проект Полевая">
          <a href="polevaya1.jpg" class="img-preview">
            <img src="polevaya1.jpg" alt="Проект «Полевая» — одноэтажный современный дом из газобетона" width="1200" height="800" loading="lazy" decoding="async" class="card-img" />
          </a>
          <button class="card-nav-btn card-prev" type="button" aria-label="Предыдущее фото">‹</button>
          <button class="card-nav-btn card-next" type="button" aria-label="Следующее фото">›</button>
          <div class="card-idx" aria-hidden="true">1/5</div>
        </div>
        <div class="card-body">
          <h3 style="margin:0;">Проект Полевая</h3>
          <div class="meta">
            <span>Газобетонный</span><span>150 м²</span><span>3 спальни</span>
          </div>
          <div class="subtle">От <strong data-price="p4">—</strong> <span class="dim">(без отделки; зависит от участка, Дранишники)</span></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <label class="btn secondary" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" class="compareCheck" data-id="p4" aria-label="Сравнить проект Полевая" /> Сравнить
            </label>
            <button class="btn" data-gen="p4" aria-controls="desc-p4">Сгенерировать описание</button>
            <button class="btn secondary" data-share="p4" aria-label="Поделиться проектом Полевая" title="Поделиться">Поделиться</button>
          </div>
          <p class="subtle" id="desc-p4" style="margin:8px 0 0;" aria-live="polite">
            Полевая — одноэтажный дом из газобетона в современном стиле, продуманный для комфортной жизни на одном уровне. 150 м² включают просторную кухню‑гостиную с выходом на террасу, мастер‑спальню с собственным санузлом, ещё две спальни и второй санузел. Чистые линии, большие окна и акцент на дневной свет. Бюджет без отделки — от 15 000 000 ₽; итоговая стоимость зависит от участка (деревня Дранишники).
          </p>
        </div>
      </article>

      <!-- Проект 5 — «32» (6 фото) -->
      <article class="card" data-id="p5" role="listitem" id="p5" data-images="p32_1.jpg,p32_2.jpg,p32_3.jpg,p32_4.jpg,p32_5.jpg,p32_6.jpg">
        <div class="card-img-wrap" tabindex="0" aria-label="Галерея изображений проекта Проект 32">
          <a href="p32_1.jpg" class="img-preview">
            <img src="p32_1.jpg" alt="Проект «32» — двухэтажный современный дом из газобетона" width="1200" height="800" loading="lazy" decoding="async" class="card-img" />
          </a>
          <button class="card-nav-btn card-prev" type="button" aria-label="Предыдущее фото">‹</button>
          <button class="card-nav-btn card-next" type="button" aria-label="Следующее фото">›</button>
          <div class="card-idx" aria-hidden="true">1/6</div>
        </div>
        <div class="card-body">
          <h3 style="margin:0;">Проект 32</h3>
          <div class="meta">
            <span>Газобетонный</span><span>250 м²</span><span>7 спален</span>
          </div>
          <div class="subtle">От <strong data-price="p5">—</strong> <span class="dim">(без отделки; зависит от участка, Дранишники, 6 соток)</span></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <label class="btn secondary" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" class="compareCheck" data-id="p5" aria-label="Сравнить проект 32" /> Сравнить
            </label>
            <button class="btn" data-gen="p5" aria-controls="desc-p5">Сгенерировать описание</button>
            <button class="btn secondary" data-share="p5" aria-label="Поделиться проектом 32" title="Поделиться">Поделиться</button>
          </div>
          <p class="subtle" id="desc-p5" style="margin:8px 0 0;" aria-live="polite">
            32 — двухэтажный дом из газобетона в современном стиле с продуманной планировкой для большой семьи. 250 м² включают просторную кухню‑гостиную с выходом на террасу, семь спален, среди которых есть отдельная мастер‑спальня с собственным санузлом, и ещё два полноценных санузла — всего три. Чистая архитектура, панорамные окна и акцент на естественный свет создают ощущение простора. Участок в деревне Дранишники, 6 соток: комфортная приватность и место для сада или зоны барбекю. Бюджет без отделки — от 25 000 000 ₽; итоговая стоимость зависит от особенностей участка и выбранных материалов.
          </p>
        </div>
      </article>

      <!-- Проект 6 — «Скандинавия» (4 фото) -->
      <article class="card" data-id="p6" role="listitem" id="p6" data-images="skandi1.jpg,skandi2.jpg,skandi3.jpg,skandi4.jpg">
        <div class="card-img-wrap" tabindex="0" aria-label="Галерея изображений проекта Проект Скандинавия">
          <a href="skandi1.jpg" class="img-preview">
            <img src="skandi1.jpg" alt="Проект «Скандинавия» — двухэтажный современный дом из газобетона" width="1200" height="800" loading="lazy" decoding="async" class="card-img" />
          </a>
          <button class="card-nav-btn card-prev" type="button" aria-label="Предыдущее фото">‹</button>
          <button class="card-nav-btn card-next" type="button" aria-label="Следующее фото">›</button>
          <div class="card-idx" aria-hidden="true">1/4</div>
        </div>
        <div class="card-body">
          <h3 style="margin:0;">Проект Скандинавия</h3>
          <div class="meta">
            <span>Газобетонный</span><span>135 м²</span><span>3 спальни</span>
          </div>
          <div class="subtle">От <strong data-price="p6">—</strong> <span class="dim">(без отделки; зависит от участка, Дранишники, 8 соток)</span></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <label class="btn secondary" style="display:flex; align-items:center; gap:8px; cursor:pointer;">
              <input type="checkbox" class="compareCheck" data-id="p6" aria-label="Сравнить проект Скандинавия" /> Сравнить
            </label>
            <button class="btn" data-gen="p6" aria-controls="desc-p6">Сгенерировать описание</button>
            <button class="btn secondary" data-share="p6" aria-label="Поделиться проектом Скандинавия" title="Поделиться">Поделиться</button>
          </div>
          <p class="subtle" id="desc-p6" style="margin:8px 0 0;" aria-live="polite">
            Проект «Скандинавия» — двухэтажный дом из газобетона, выполненный в лаконичном современном стиле. 135 м² продуманного пространства: кухня‑гостиная с выходом на террасу, мастер‑спальня и ещё две спальни; всего два санузла. Большие окна, чистые линии, максимум дневного света. Дранишники, участок 8 соток. Стоимость без отделки — от 15 000 000 ₽; итог зависит от особенностей участка и выбранных материалов.
          </p>
        </div>
      </article>
    </div>
  </section>

  <section id="compare" class="fade-in" hidden>
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h2>Сравнение проектов</h2>
      <button class="btn secondary" id="clearCompare">Очистить сравнение</button>
    </div>
    <div id="compareHint" class="subtle" style="margin-bottom:12px;">Выберите два проекта для сравнения</div>
    <div id="compareTableWrap" aria-live="polite"></div>
  </section>

  <section id="calculator" class="fade-in">
    <h2>Калькулятор стоимости</h2>
    <label for="area">Площадь дома (м²):</label>
    <input type="number" id="area" placeholder="Например, 250" min="50" max="1000" step="10" inputmode="numeric" autocomplete="off" />

    <label for="type">Строительство:</label>
    <select id="type">
      <option value="build_nomats" data-price="20000">Без материалов — 20 000 ₽/м²</option>
      <option value="build_with" data-price="50000">С материалами — 50 000 ₽/м²</option>
    </select>

    <label for="finish">Отделка:</label>
    <select id="finish">
      <option value="finish_none" data-price="0">Без отделки</option>
      <option value="finish_nomats" data-price="20000">Без материалов — 20 000 ₽/м²</option>
      <option value="finish_with" data-price="50000">С материалами — 50 000 ₽/м²</option>
    </select>

    <p id="price" role="status" aria-live="polite">Стоимость: —</p>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <button class="btn" id="usePriceForMortgage" disabled>Передать стоимость в ипотечный калькулятор</button>
      <button class="btn secondary" id="copyEstimate" disabled>Скопировать расчёт</button>
    </div>
    <p class="subtle">Расчёт ориентировочный и не является публичной офертой.</p>

    <div class="chart-card" aria-live="polite">
      <h3 style="margin:6px 0 8px;">Ставки по работам (₽/м²)</h3>
      <div id="priceChart"></div>
      <div class="chart-legend">
        <span><i style="background: var(--accent);"></i> Строительство</span>
        <span><i style="background: color-mix(in srgb, var(--accent) 60%, #10b981 40%);"></i> Отделка</span>
      </div>
    </div>
  </section>

  <section id="mortgage" class="fade-in">
    <h2>Ипотечный калькулятор</h2>
    <div style="display:grid;grid-template-columns:1fr;gap:0;">
      <label for="homePrice">Стоимость дома (₽):</label>
      <input type="text" id="homePrice" placeholder="Например, 25 000 000" inputmode="numeric" autocomplete="off" />
      <label for="downPayment">Первоначальный взнос (₽):</label>
      <input type="text" id="downPayment" placeholder="Например, 5 000 000" inputmode="numeric" autocomplete="off" />
      <label for="rate">Ставка, % годовых:</label>
      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <input type="number" id="rate" placeholder="Например, 15" min="1" max="40" step="0.1" inputmode="decimal" style="flex:1 1 220px;" />
        <button class="btn secondary" id="refreshKeyRate" type="button" title="Обновить по ключевой ставке ЦБ">Обновить ставку ЦБ</button>
      </div>
      <p id="keyRateStatus" class="subtle" aria-live="polite"></p>
      <label for="years">Срок, лет:</label>
      <input type="number" id="years" placeholder="Например, 20" min="1" max="40" step="1" inputmode="numeric" />
    </div>
    <button class="btn" id="calcMortgage">Рассчитать платёж</button>
    <p id="mortgageResult" role="status" aria-live="polite">—</p>
    <p class="subtle">Подсказка: комфортная нагрузка — не более 30–40% от дохода семьи.</p>
  </section>

  <section id="qa" class="fade-in">
    <h2>Информация по районам</h2>
    <label for="district">Введите район/населённый пункт:</label>
    <input type="text" id="district" placeholder="Например, Сестрорецк, Парголово, Всеволожск" list="districtList" />
    <datalist id="districtList">
      <option value="Приморский"></option>
      <option value="Сестрорецк"></option>
      <option value="Парголово"></option>
      <option value="Выборгский"></option>
      <option value="Всеволожск"></option>
      <option value="Комарово"></option>
      <option value="Зеленогорск"></option>
      <option value="Кудрово"></option>
      <option value="Пушкин"></option>
      <option value="Павловск"></option>
      <option value="Сертолово"></option>
      <option value="Мурино"></option>
      <option value="Дранишники"></option>
    </datalist>
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
      <button class="btn" id="askDistrict" type="button">Показать информацию</button>
      <button class="btn secondary" id="clearDistrict" type="button">Очистить</button>
    </div>
    <div id="districtInfo" style="margin-top:12px;" aria-live="polite"></div>
    <div id="districtMapWrap" style="margin-top:12px;">
      <iframe id="districtMap" class="map-embed" src="https://www.google.com/maps?q=Saint%20Petersburg&output=embed" loading="lazy" title="Карта районов — Санкт-Петербург и ЛО" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </section>

  <section id="contact" class="fade-in">
    <h2>Связаться по email</h2>
    <form id="emailForm" aria-label="Форма связи">
      <input type="text" name="honeypot" aria-hidden="true" tabindex="-1" class="sr-only" autocomplete="off" />
      <label for="name">Ваше имя</label>
      <input type="text" id="name" name="name" placeholder="Иван" required autocomplete="name" />
      <label for="email">Ваш email</label>
      <input type="email" id="email" name="email" placeholder="name@example.com" required autocomplete="email" />
      <label for="message">Сообщение</label>
      <textarea id="message" name="message" placeholder="Расскажите, какой дом вы планируете" required></textarea>
      <label for="preferredTime">Удобное время для звонка</label>
      <input type="text" id="preferredTime" name="preferredTime" placeholder="Например, завтра с 12:00 до 16:00" autocomplete="off" />
      <input type="submit" value="Открыть письмо в почтовом клиенте" class="submit" />
    </form>
    <p id="contactStatus" class="subtle" role="status" aria-live="polite"></p>
    <div style="margin-top:8px;">
      <a class="btn secondary" href="mailto:info@domveka.ru">Написать на info@domveka.ru</a>
    </div>
  </section>

  <div class="sticky-cta">
    <a href="#contact" class="btn">Запросить консультацию</a>
    <a href="mailto:info@domveka.ru" class="btn secondary">Написать на email</a>
  </div>

  <footer>
    &copy; <span id="year"></span> Dom Veka. Все права защищены. |
    <a href="mailto:info@domveka.ru">info@domveka.ru</a> |
    <a href="tel:+78121234567">+7 (812) 123-45-67</a>
  </footer>

  <button id="backToTop" aria-label="Наверх" title="Наверх">⬆</button>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Модалка полноразмерного изображения -->
  <div id="modalImg" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Просмотр изображения">
    <button id="modalImg__close" type="button" aria-label="Закрыть">✕</button>
    <button id="modalImg__prev" type="button" aria-label="Предыдущее фото">‹</button>
    <button id="modalImg__next" type="button" aria-label="Следующее фото">›</button>
    <div id="modalImg__idx" aria-live="polite">—</div>
    <img id="modalImg__img" alt="">
  </div>
</body>
<script>
// Dom Veka — стабильный JS. Сохранены все функции старого кода + обновлены данные проектов p1 и p2.
document.addEventListener('DOMContentLoaded', () => {
  'use strict';

  // ——— Утилиты
  document.documentElement.classList.add('js');
  const nf = new Intl.NumberFormat('ru-RU');
  const fmtCurrency = (n) => (Number.isFinite(n) ? nf.format(Math.round(n)).replace(/\u00A0/g,' ') + ' ₽' : '—');
  const fmtIntSpaced = (n) => (Number.isFinite(n) ? nf.format(Math.round(n)).replace(/\u00A0/g,' ') : '');
  const qs = (sel, el=document) => el.querySelector(sel);
  const qsa = (sel, el=document) => Array.from(el.querySelectorAll(sel));
  const saveLS = (k,v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} };
  const readLS = (k,def=null)=>{ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):def; }catch{ return def; } };
  const toast = (msg)=>{ const el=qs('#toast'); if(!el) return; el.textContent=msg; el.classList.add('show'); clearTimeout(el._t); el._t=setTimeout(()=>el.classList.remove('show'),2200); };

  // ——— Данные (обновлены p1 и p2 под задачу)
  const PROJECTS = [
    // p1: Проект 46 — 180 м², 4 спальни, 3 санузла, одноэтажный, цена от 30 млн, 4 фото
    { id:"p1", name:"Проект 46", type:"Кирпичный", area:180, bedrooms:4, baths:3, floors:1, lot:0,
      basePricePerM2:166667, // чтобы не ломать расчёт, если нет override (~30 млн / 180)
      images:["house1.jpg","house1_2.jpg","house1_3.jpg","house1_4.jpg"], image:"house1.jpg",
      location:"Всеволожский район", minPriceOverride:30000000, dependsOnLot:true },

    // p2: Проект 180 — 135 м², 3 спальни, 2 санузла, одноэтажный, 4 фото
    { id:"p2", name:"Проект 180", type:"Газобетонный", area:135, bedrooms:3, baths:2, floors:1, lot:0,
      basePricePerM2:120000,
      images:["house2.jpg","house2_2.jpg","house2_3.jpg","house2_4.jpg"], image:"house2.jpg",
      location:"Приморский район" },

    // p3 — «Проект 175» (как было)
    { id:"p3", name:"Проект 175", type:"Газобетонный", area:200, bedrooms:4, baths:3, lot:0,
      basePricePerM2:150000, images:["house3.jpg","house3_2.jpg","house3_3.jpg","house3_4.jpg","house3_5.jpg"],
      image:"house3.jpg", location:"Всеволожский район", minPriceOverride:30000000 },

    // p4 — «Проект Полевая»
    { id:"p4", name:"Проект Полевая", type:"Газобетонный", area:150, bedrooms:3, baths:2, lot:0,
      basePricePerM2:100000, images:["polevaya1.jpg","polevaya2.jpg","polevaya3.jpg","polevaya4.jpg","polevaya5.jpg"],
      image:"polevaya1.jpg", location:"Дранишники", minPriceOverride:15000000 },

    // p5 — «Проект 32»
    { id:"p5", name:"Проект 32", type:"Газобетонный", area:250, bedrooms:7, baths:3, lot:6,
      basePricePerM2:100000, images:["p32_1.jpg","p32_2.jpg","p32_3.jpg","p32_4.jpg","p32_5.jpg","p32_6.jpg"],
      image:"p32_1.jpg", location:"Дранишники", minPriceOverride:25000000 },

    // p6 — «Проект Скандинавия»
    { id:"p6", name:"Проект Скандинавия", type:"Газобетонный", area:135, bedrooms:3, baths:2, lot:8,
      basePricePerM2:111112, images:["skandi1.jpg","skandi2.jpg","skandi3.jpg","skandi4.jpg"],
      image:"skandi1.jpg", location:"Дранишники", minPriceOverride:15000000 }
  ];

  // ——— Районы
  const DISTRICTS = {
    "приморский": { title:"Приморский район", info:"Север СПб: метро, выезды на ЗСД/КАД, парки и набережные. Развитая среда, высокий спрос на ИЖС, стоимость участков средняя и выше.", mapQuery:"Приморский район, Санкт-Петербург" },
    "сестрорецк": { title:"Сестрорецк", info:"Курортная зона у Финского залива: сосны, пляжи, чистый воздух. В основном ИЖС и дачная застройка, комфортно для ПМЖ и дачи.", mapQuery:"Сестрорецк" },
    "парголово": { title:"Парголово", info:"Близость к КАД/ЗСД и лесам, смешанная застройка. Удобная логистика на север СПб, рядом ТЦ, школы, садики.", mapQuery:"Парголово" },
    "выборгский": { title:"Выборгский район", info:"Баланс природы и инфраструктуры, востребован под ИЖС. Удобные выезды, развитые районы, парки.", mapQuery:"Выборгский район, Санкт-Петербург" },
    "всеволожск": { title:"Всеволожск", info:"Город-спутник: зелёные зоны, коттеджные посёлки, железнодорожное сообщение. Комфортная среда для ПМЖ.", mapQuery:"Всеволожск" },
    "комарово": { title:"Комарово", info:"Статусная дачная локация у залива: сосновые леса, тишина. Высокая стоимость земли, камерная застройка.", mapQuery:"Комарово" },
    "зеленогорск": { title:"Зеленогорск", info:"Курортный город на берегу: инфраструктура, пляжи, климат. Удобен для круглогодичной жизни и отдыха.", mapQuery:"Зеленогорск" },
    "кудрово": { title:"Кудрово", info:"Плотная городская среда у метро. Практично как временное жильё на период стройки; рядом ТЦ и сервисы.", mapQuery:"Кудрово" },
    "пушкин": { title:"Пушкин", info:"Историческая среда, парки и дворцы, спокойный темп. Удобный выезд к КАД и аэропорту.", mapQuery:"Пушкин" },
    "павловск": { title:"Павловск", info:"Тихий пригород, малоэтажная застройка, парк. Популярная локация для частных домов.", mapQuery:"Павловск" },
    "сертолово": { title:"Сертолово", info:"Север СПб: развивающаяся инфраструктура, лесные массивы, быстрый выезд на КАД. Доступные участки.", mapQuery:"Сертолово" },
    "мурино": { title:"Мурино", info:"Близко к метро, высокая плотность. Подходит как временная база на время строительства дома.", mapQuery:"Мурино" },
    "дранишники": { title:"Дранишники", info:"Посёлок во Всеволожском районе: тихо, малоэтажная застройка, участки под ИЖС. Уточняйте статус коммуникаций (электричество, газ, вода) и подъезд.", mapQuery:"Дранишники Ленинградская область" }
  };
  const districtFallback = (name)=>{
    const base = name || 'Выбранная локация';
    return {
      title: base,
      info: `${base}: проверьте подъезд, статусы коммуникаций (электричество, газ, вода), расстояние до КАД/метро и состав грунтов.`,
      mapQuery: `${base} Ленинградская область`
    };
  };

  // ——— Базовое
  const progressEl = qs('#progress');
  const backToTop = qs('#backToTop');
  const mainNav = qs('#mainNav');
  const themeToggle = qs('#themeToggle');
  const dynamicThemeMeta = qs('#dynamic-theme-color');
  const yearEl = qs('#year');
  if (yearEl) yearEl.textContent = String(new Date().getFullYear());

  // ——— Прогресс и “Наверх”
  const updateProgress = ()=>{
    const doc = document.documentElement;
    const H = doc.scrollHeight - doc.clientHeight;
    const sc = H>0 ? (window.scrollY||0)/H : 0;
    if (progressEl) progressEl.style.transform = 'scaleX(' + Math.max(0,Math.min(1,sc)) + ')';
    if (backToTop) backToTop.classList.toggle('show', (window.scrollY||0) > 500);
  };
  window.addEventListener('scroll', updateProgress, {passive:true});
  window.addEventListener('resize', updateProgress);
  updateProgress();
  backToTop?.addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0, behavior:'smooth'}); });

  // ——— Скрытие навбара
  (function navAutoHide(){
    if (!mainNav) return;
    let lastY = window.scrollY||0;
    window.addEventListener('scroll', ()=>{
      const y = window.scrollY||0;
      const dy = y - lastY;
      if (y > 120 && dy > 6) mainNav.classList.add('nav-hidden');
      else if (dy < -6 || y < 80) mainNav.classList.remove('nav-hidden');
      lastY = y;
    }, {passive:true});
  })();

  // ——— Тема + theme-color
  (function initTheme(){
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const saved = readLS('theme', null);
    const initial = (saved==='dark'||saved==='light') ? saved : (prefersDark ? 'dark' : 'light');
    setTheme(initial);
    themeToggle?.addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') || (prefersDark ? 'dark' : 'light');
      setTheme(cur==='dark' ? 'light' : 'dark');
      toast(cur==='dark' ? 'Светлая тема' : 'Тёмная тема');
    });
    function setTheme(theme){
      document.documentElement.setAttribute('data-theme', theme);
      document.body.style.colorScheme = theme;
      saveLS('theme', theme);
      if (themeToggle){
        themeToggle.setAttribute('aria-pressed', String(theme==='dark'));
        themeToggle.textContent = theme==='dark' ? '☀️ Тема' : '🌙 Тема';
      }
      const meta = dynamicThemeMeta;
      if (meta){
        const color = getComputedStyle(document.documentElement).getPropertyValue('--theme-color').trim() || (theme==='dark' ? '#0e1524' : '#f3f4f6');
        meta.setAttribute('content', color);
      }
    }
  })();

  // ——— Появление секций
  (function revealOnScroll(){
    const items = qsa('.fade-in');
    if ('IntersectionObserver' in window){
      const io = new IntersectionObserver((entries, obs)=>{
        entries.forEach(e=>{
          if (e.isIntersecting){
            e.target.classList.add('anim-shown');
            obs.unobserve(e.target);
          }
        });
      }, { threshold:0.12 });
      items.forEach(el=>io.observe(el));
    } else {
      items.forEach(el=>el.classList.add('anim-shown'));
    }
  })();

  // ——— Цены в карточках (учёт minPriceOverride)
  (function initProjectPrices(){
    PROJECTS.forEach(p=>{
      const el = document.querySelector(`[data-price="${p.id}"]`);
      if (!el) return;
      const calc = p.minPriceOverride ? p.minPriceOverride : (p.area * p.basePricePerM2);
      el.textContent = fmtCurrency(calc);
    });
  })();

  // ——— Модалка изображений + карусели
  const modal = qs('#modalImg');
  const modalImg = qs('#modalImg__img');
  const modalClose = qs('#modalImg__close');
  const modalPrev = qs('#modalImg__prev');
  const modalNext = qs('#modalImg__next');
  const modalIdx = qs('#modalImg__idx');
  let modalState = { list:[], idx:0 };

  function renderModal(){
    if (!modal || !modalImg || !modalIdx) return;
    const img = modalState.list[modalState.idx];
    modalImg.src = img || '';
    modalIdx.textContent = modalState.list.length ? `${modalState.idx+1}/${modalState.list.length}` : '—';
  }
  function openModalImage(src, list=[], startIdx=0){
    modalState.list = (list && list.length) ? list : (src?[src]:[]);
    const found = modalState.list.indexOf(src);
    modalState.idx = (found>=0 ? found : Math.max(0, Math.min(startIdx, modalState.list.length-1)));
    renderModal();
    modal?.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
  }
  function closeModal(){
    modal?.setAttribute('aria-hidden','true');
    document.body.style.overflow = '';
    if (modalImg) modalImg.src = '';
    modalState = { list:[], idx:0 };
  }
  function nextModal(){ if (!modalState.list.length) return; modalState.idx = (modalState.idx+1) % modalState.list.length; renderModal(); }
  function prevModal(){ if (!modalState.list.length) return; modalState.idx = (modalState.idx-1+modalState.list.length) % modalState.list.length; renderModal(); }

  modalClose?.addEventListener('click', closeModal);
  modalNext?.addEventListener('click', nextModal);
  modalPrev?.addEventListener('click', prevModal);
  modal?.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });
  window.addEventListener('keydown', (e)=>{
    if (!modal || modal.getAttribute('aria-hidden')==='true') return;
    if (e.key==='Escape') closeModal();
    if (e.key==='ArrowRight') nextModal();
    if (e.key==='ArrowLeft') prevModal();
  });

  (function initCardGalleries(){
    qsa('.card').forEach(card=>{
      const wrap = qs('.card-img-wrap', card);
      const img = qs('img.card-img', card);
      const link = qs('.img-preview', card);
      const btnPrev = qs('.card-prev', card);
      const btnNext = qs('.card-next', card);
      const idxBadge = qs('.card-idx', card);
      const imgs = (card.getAttribute('data-images')||'').split(',').map(s=>s.trim()).filter(Boolean);
      if (!wrap || !img || !imgs.length) return;
      let idx = 0;
      const render = ()=>{
        img.src = imgs[idx];
        if (link) link.setAttribute('href', imgs[idx]);
        if (idxBadge) idxBadge.textContent = `${idx+1}/${imgs.length}`;
      };
      const next = ()=>{ idx = (idx+1) % imgs.length; render(); };
      const prev = ()=>{ idx = (idx-1+imgs.length) % imgs.length; render(); };
      btnPrev?.addEventListener('click', (e)=>{ e.preventDefault(); prev(); });
      btnNext?.addEventListener('click', (e)=>{ e.preventDefault(); next(); });
      wrap.addEventListener('keydown', (e)=>{
        if (e.key==='ArrowLeft'){ e.preventDefault(); prev(); }
        if (e.key==='ArrowRight'){ e.preventDefault(); next(); }
        if (e.key==='Enter'){ e.preventDefault(); openModalImage(imgs[idx], imgs, idx); }
      });
      link?.addEventListener('click', (e)=>{
        e.preventDefault();
        openModalImage(imgs[idx], imgs, idx);
      });
      // свайп
      let startX=0, swiping=false;
      wrap.addEventListener('pointerdown', (e)=>{ swiping=true; startX=e.clientX; });
      wrap.addEventListener('pointerup', (e)=>{
        if(!swiping) return;
        const dx = e.clientX - startX;
        if (Math.abs(dx) > 30){ dx<0 ? next() : prev(); }
        swiping=false;
      });
      render();
    });
  })();

  // ——— Генерация описаний/шеринг (обновлены тексты p1 и p2)
  function generateDescription(p){
    // Индивидуальные тексты для p1 и p2 согласно задаче
    if (p.id === 'p1'){
      const price = fmtCurrency(p.minPriceOverride ?? (p.area * p.basePricePerM2));
      return `Проект 46 — одноэтажный современный дом, ${p.area} м²: 4 спальни (включая мастер‑спальню), кухня‑гостиная с выходом на террасу, ${p.baths} санузла. Стоимость от ${price}; итог зависит от участка.`;
    }
    if (p.id === 'p2'){
      return `Проект 180 — одноэтажный дом, ${p.area} м²: 3 спальни (включая мастер‑спальню), кухня‑гостиная с выходом на террасу, панорамные окна, ${p.baths} санузла. Современный лаконичный стиль и максимум света.`;
    }
    // Общий генератор (как было)
    const style = p.type==="Кирпичный" ? "европейский минимализм" : p.type==="Газобетонный" ? "скандиминимализм" : "современная классика";
    const commute = /Примор|Лахта|Курорт|Сестрорецк|Лисий Нос|Парголово|Парнас/.test(p.location) ? "15–30 минут до центра" : "30–50 минут до центра";
    const lotText = p.lot ? `Участок ${p.lot} соток — место для сада и барбекю. ` : "";
    const price = fmtCurrency(p.minPriceOverride ? p.minPriceOverride : (p.area * p.basePricePerM2));
    const hooks = ["панорамное остекление","высокие потолки","пространство без лишних стен","тёплый пол","вентфасад"];
    const hook = hooks[p.area % hooks.length];
    if (p.id === 'p3'){
      return `Проект 175: одноэтажный дом из газобетона, ${p.area} м². Современная архитектура и функциональная планировка: кухнягостиная с выходом на террасу, мастерспальня с собственным санузлом, ещё три спальни — всего ${p.baths} санузла. ${lotText}Локация: ${p.location} (${commute}). Бюджет от ${price} (без отделки).`;
    }
    if (p.id === 'p4'){
      return `Проект Полевая: одноэтажный дом из газобетона, ${p.area} м². Современный стиль, кухня‑гостиная с выходом на террасу, мастер‑спальня с собственным санузлом, ещё две спальни — всего ${p.baths} санузла. Локация: ${p.location}. Бюджет от ${price} (без отделки, зависит от участка).`;
    }
    if (p.id === 'p5'){
      return `Проект 32: двухэтажный дом из газобетона, ${p.area} м². Современная архитектура, кухня‑гостиная с выходом на террасу, 7 спален, включая мастер‑спальню с собственным санузлом; всего ${p.baths} санузла. ${lotText}Локация: ${p.location}. Бюджет от ${price} (без отделки, зависит от участка — 6 соток).`;
    }
    if (p.id === 'p6'){
      return `Проект Скандинавия: двухэтажный дом из газобетона, ${p.area} м². Чистые линии и свет: кухня‑гостиная с выходом на террасу, мастер‑спальня и ещё две спальни; всего ${p.baths} санузла. ${lotText}Локация: ${p.location}. Бюджет от ${price} (без отделки; участок ${p.lot} соток).`;
    }
    return `${p.name}: ${p.type.toLowerCase()}, ${p.area} м², ${p.bedrooms} спальни. Стиль — ${style}. ${lotText}Локация: ${p.location} (${commute}). Бюджет от ${price}. Акцент: ${hook}.`;
  }

  qsa('[data-gen]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-gen');
      const p = PROJECTS.find(x=>x.id===id);
      const el = qs('#desc-'+id);
      if (p && el){ el.textContent = generateDescription(p); toast('Описание сгенерировано'); }
    });
  });

  qsa('[data-share]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const id = btn.getAttribute('data-share');
      const p = PROJECTS.find(x=>x.id===id);
      if (!p) return;
      const price = fmtCurrency(p.minPriceOverride ? p.minPriceOverride : (p.area * p.basePricePerM2));
      const text = `${p.name} — ${p.type}, ${p.area} м², ${p.bedrooms} спальни. Бюджет от ${price}. Локация: ${p.location}.`;
      const url = location.href.split('#')[0] + '#gallery';
      try{
        if (navigator.share){
          await navigator.share({ title:p.name, text, url });
        }else if (navigator.clipboard){
          await navigator.clipboard.writeText(`${text}\n${url}`);
          toast('Ссылка скопирована');
        }else{
          location.href = `mailto:?subject=${encodeURIComponent(p.name)}&body=${encodeURIComponent(text+'\n'+url)}`;
        }
      }catch{}
    });
  });

  // ——— Сравнение (до 2 проектов)
  const compareSet = new Set();
  const compareSection = qs('#compare');
  const compareHint = qs('#compareHint');
  const compareTableWrap = qs('#compareTableWrap');
  const clearCompareBtn = qs('#clearCompare');

  function updateCompareUI(){
    if (!compareSection || !compareHint || !compareTableWrap) return;
    if (compareSet.size === 0){
      compareSection.hidden = true; compareTableWrap.innerHTML = ""; compareHint.textContent = "Выберите два проекта для сравнения";
      return;
    }
    compareSection.hidden = false;
    if (compareSet.size === 1){
      compareHint.textContent = "Выберите ещё один проект для сравнения";
      compareTableWrap.innerHTML = "";
      return;
    }
    compareHint.textContent = "Сравнение готово";
    const [idA, idB] = Array.from(compareSet);
    const a = PROJECTS.find(p=>p.id===idA);
    const b = PROJECTS.find(p=>p.id===idB);
    if (!a || !b){ compareTableWrap.innerHTML = ""; return; }
    const rows = [
      ["Проект", a.name, b.name],
      ["Тип", a.type, b.type],
      ["Площадь", a.area+" м²", b.area+" м²"],
      ["Спальни", a.bedrooms, b.bedrooms],
      ["Санузлы", a.baths, b.baths],
      ["Участок", (a.lot||"—")+" сот.", (b.lot||"—")+" сот."],
      ["Цена за м²", fmtCurrency(a.basePricePerM2), fmtCurrency(b.basePricePerM2)],
      ["Оценка бюджета", fmtCurrency((a.minPriceOverride ?? (a.area*a.basePricePerM2))), fmtCurrency((b.minPriceOverride ?? (b.area*b.basePricePerM2)))],
      ["Локация", a.location, b.location]
    ];
    let html = `<table class="compare-table"><thead><tr><th>Параметр</th><th>${a.name}</th><th>${b.name}</th></tr></thead><tbody>`;
    rows.forEach(r=>{ html += `<tr><th>${r[0]}</th><td>${r[1]}</td><td>${r[2]}</td></tr>`; });
    html += '</tbody></table>';
    compareTableWrap.innerHTML = html;
  }

  qsa('.compareCheck').forEach(ch=>{
    ch.addEventListener('change', ()=>{
      const id = ch.getAttribute('data-id');
      if (!id) return;
      if (ch.checked){
        if (compareSet.size >= 2){
          ch.checked = false;
          toast('Можно сравнить не более 2 проектов');
          ch.closest('.card')?.classList.add('shake');
          setTimeout(()=>ch.closest('.card')?.classList.remove('shake'), 320);
          return;
        }
        compareSet.add(id);
      } else {
        compareSet.delete(id);
      }
      updateCompareUI();
    });
  });

  clearCompareBtn?.addEventListener('click', ()=>{
    compareSet.clear();
    qsa('.compareCheck').forEach(ch=>ch.checked=false);
    updateCompareUI();
  });

  // ——— Фильтры и вид галереи
  (function initFiltersAndView(){
    const grid = qs('#projectsGrid');
    if (!grid) return;
    const filterBrick = qs('#filterBrick');
    const filterAac = qs('#filterAac');
    const resetFilter = qs('#resetFilter');
    const viewComfort = qs('#viewComfort');
    const viewCompact = qs('#viewCompact');

    function applyFilter(type){
      qsa('.card', grid).forEach(c=>{
        const t = c.querySelector('.meta')?.textContent || '';
        if (!type){ c.classList.remove('dim'); }
        else c.classList.toggle('dim', !new RegExp(type).test(t));
      });
    }
    filterBrick?.addEventListener('click', ()=>applyFilter('Кирпичный'));
    filterAac?.addEventListener('click', ()=>applyFilter('Газобетонный'));
    resetFilter?.addEventListener('click', ()=>applyFilter(null));

    const saved = readLS('viewMode','comfort');
    if(saved === 'compact') grid.classList.add('compact');
    viewCompact?.addEventListener('click', ()=>{ grid.classList.add('compact'); saveLS('viewMode','compact'); });
    viewComfort?.addEventListener('click', ()=>{ grid.classList.remove('compact'); saveLS('viewMode','comfort'); });
  })();

  // ——— Калькулятор стоимости (совместимый)
  const areaEl = qs('#area');
  const typeEl = qs('#type');
  const finishEl = qs('#finish');
  const energyEl = qs('#energy'); // может отсутствовать
  const priceEl = qs('#price');
  const useForMortgageBtn = qs('#usePriceForMortgage');
  const copyEstimateBtn = qs('#copyEstimate');
  const priceChartWrap = qs('#priceChart');

  const getSelNum = (el, key) => Number(el?.selectedOptions?.[0]?.dataset?.[key] ?? NaN);
  function isNewCalcMode(){
    return Number.isFinite(getSelNum(typeEl,'price')) && Number.isFinite(getSelNum(finishEl,'price'));
  }
  function calcEstimateValue(){
    const area = Number(areaEl?.value);
    if (!Number.isFinite(area) || area <= 0) return null;
    if (isNewCalcMode()){
      const build = getSelNum(typeEl,'price') || 0;
      const finish = getSelNum(finishEl,'price') || 0;
      return area * (build + finish);
    } else {
      const base = getSelNum(typeEl,'price') || 0;
      const mFinish = getSelNum(finishEl,'mult') || 1;
      const mEnergy = getSelNum(energyEl,'mult') || 1;
      return area * base * mFinish * mEnergy;
    }
  }
  function renderEstimate(){
    const total = calcEstimateValue();
    if (total){
      if (priceEl) priceEl.textContent = 'Стоимость: ' + fmtCurrency(total);
      useForMortgageBtn && (useForMortgageBtn.disabled = false);
      copyEstimateBtn && (copyEstimateBtn.disabled = false);
    } else {
      if (priceEl) priceEl.textContent = 'Стоимость: —';
      useForMortgageBtn && (useForMortgageBtn.disabled = true);
      copyEstimateBtn && (copyEstimateBtn.disabled = true);
    }
    renderPriceChart();
  }
  function renderPriceChart(){
    if (!priceChartWrap) return;
    if (isNewCalcMode()){
      const build = getSelNum(typeEl,'price') || 0;
      const finish = getSelNum(finishEl,'price') || 0;
      const max = Math.max(build, finish, 1);
      const bar = (label, value, color) => `
        <div style="margin:8px 0;">
          <div style="display:flex;justify-content:space-between;align-items:baseline;">
            <strong>${label}</strong><span class="subtle">${fmtIntSpaced(value)} / м²</span>
          </div>
          <div style="height:10px;background:var(--border);border-radius:999px;overflow:hidden;">
            <div style="height:10px;width:${(value/max)*100}%;background:${color};border-radius:999px;"></div>
          </div>
        </div>`;
      priceChartWrap.innerHTML =
        bar("Строительство", build, "var(--accent)") +
        bar("Отделка", finish, "color-mix(in srgb, var(--accent) 60%, #10b981 40%)");
    } else {
      const brick = Number(qs('#type option[value="brick"]')?.dataset?.price || 150000);
      const aac = Number(qs('#type option[value="aac"]')?.dataset?.price || 120000);
      const max = Math.max(brick, aac, 1);
      const bar = (label, value, color) => `
        <div style="margin:8px 0;">
          <div style="display:flex;justify-content:space-between;align-items:baseline;">
            <strong>${label}</strong><span class="subtle">${fmtIntSpaced(value)} / м²</span>
          </div>
          <div style="height:10px;background:var(--border);border-radius:999px;overflow:hidden;">
            <div style="height:10px;width:${(value/max)*100}%;background:${color};border-radius:999px;"></div>
          </div>
        </div>`;
      priceChartWrap.innerHTML =
        bar("Кирпичный", brick, "var(--accent)") +
        bar("Газобетонный", aac, "color-mix(in srgb, var(--accent) 60%, #10b981 40%)");
    }
  }
  ['input','change'].forEach(ev=>{
    areaEl?.addEventListener(ev, renderEstimate);
    typeEl?.addEventListener(ev, renderEstimate);
    finishEl?.addEventListener(ev, renderEstimate);
    energyEl?.addEventListener(ev, renderEstimate);
  });
  renderEstimate();

  copyEstimateBtn?.addEventListener('click', async ()=>{
    const area = Number(areaEl?.value);
    const total = calcEstimateValue();
    if (!total) return;
    let text;
    if (isNewCalcMode()){
      const build = getSelNum(typeEl,'price') || 0;
      const finish = getSelNum(finishEl,'price') || 0;
      text = `Оценка стоимости дома:
Площадь: ${area} м²
Строительство: ${fmtIntSpaced(build)} ₽/м²
Отделка: ${fmtIntSpaced(finish)} ₽/м²
Итого за м²: ${fmtIntSpaced(build + finish)} ₽/м²
Итого: ${fmtCurrency(total)}`;
    } else {
      const base = getSelNum(typeEl,'price') || 0;
      const mFinish = getSelNum(finishEl,'mult') || 1;
      const mEnergy = getSelNum(energyEl,'mult') || 1;
      text = `Оценка стоимости дома:
Площадь: ${area} м²
База: ${fmtIntSpaced(base)} ₽/м²
Отделка (множитель): ×${mFinish}
Энергоэффективность (множитель): ×${mEnergy}
Итого: ${fmtCurrency(total)}`;
    }
    try{
      await navigator.clipboard.writeText(text);
      toast('Расчёт скопирован');
    }catch{ toast('Не удалось скопировать'); }
  });

  // ——— Ипотечный калькулятор
  const homePriceEl = qs('#homePrice');
  const downEl = qs('#downPayment');
  const rateEl = qs('#rate');
  const yearsEl = qs('#years');
  const resultEl = qs('#mortgageResult');
  const refreshKeyBtn = qs('#refreshKeyRate');
  const keyRateStatus = qs('#keyRateStatus');
  const calcMortgageBtn = qs('#calcMortgage');

  const isTextInput = (el)=> el && el.tagName==='INPUT' && (el.type==='text' || el.getAttribute('type')==='text');
  const digitsOnly = (s)=> (s||'').toString().replace(/\D+/g,'');
  const formatDigitsWithSpaces = (s)=> s.replace(/\B(?=(\d{3})+(?!\d))/g,' ');

  function bindMoneyFormatter(input){
    if (!input || !isTextInput(input)) return;
    const setFormatted = ()=>{
      const raw = digitsOnly(input.value);
      if (!raw){ input.value=''; return; }
      input.value = formatDigitsWithSpaces(raw);
    };
    input.addEventListener('input', setFormatted);
    input.addEventListener('blur', setFormatted);
    input.addEventListener('paste', (e)=>{
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData('text');
      const raw = digitsOnly(text);
      input.value = formatDigitsWithSpaces(raw);
    });
    setFormatted();
  }
  bindMoneyFormatter(homePriceEl);
  bindMoneyFormatter(downEl);

  function parseMoneyInput(el){
    if (!el) return 0;
    const v = el.value;
    if (isTextInput(el)){
      const raw = digitsOnly(v);
      return raw ? Number(raw) : 0;
    }
    return Number(v||0);
  }

  function calcMortgage(){
    const price = parseMoneyInput(homePriceEl);
    const down = parseMoneyInput(downEl);
    const rate = Number(rateEl?.value);
    const years = Number(yearsEl?.value);
    if (!price || !rate || !years || price <= 0 || years <= 0){
      if (resultEl) resultEl.textContent = 'Проверьте введённые значения';
      return;
    }
    const loan = price - down;
    if (loan <= 0){ resultEl.textContent = 'Сумма кредита должна быть больше 0'; return; }
    const r = rate / 100 / 12;
    const n = years * 12;
    const k = (r === 0) ? (1/n) : (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
    const payment = loan * k;
    const totalPay = payment * n;
    const overpay = totalPay - loan;
    resultEl.textContent = `Ежемесячный платёж: ${fmtCurrency(payment)} • Переплата: ${fmtCurrency(overpay)}`;
  }
  calcMortgageBtn?.addEventListener('click', calcMortgage);

  const useForMortgageBtn2 = qs('#usePriceForMortgage');
  useForMortgageBtn2?.addEventListener('click', ()=>{
    const total = calcEstimateValue();
    if (!total) return;
    const val = String(Math.round(total));
    if (homePriceEl){
      if (isTextInput(homePriceEl)){
        homePriceEl.value = formatDigitsWithSpaces(val);
      }else{
        homePriceEl.value = val;
      }
    }
    location.hash = '#mortgage';
    toast('Стоимость передана в ипотечный калькулятор');
  });

  refreshKeyBtn?.addEventListener('click', ()=>{
    const sample = 16.0; // ориентир
    if (rateEl) rateEl.value = String(sample);
    if (keyRateStatus) keyRateStatus.textContent = `Ставка обновлена (ориентир: ${sample}%)`;
    toast('Ставка обновлена');
  });

  // ——— Районы + карта
  const districtInput = qs('#district');
  const askDistrict = qs('#askDistrict');
  const clearDistrict = qs('#clearDistrict');
  const districtInfo = qs('#districtInfo');
  const districtMap = qs('#districtMap');

  askDistrict?.addEventListener('click', ()=>{
    const input = (districtInput?.value || '').trim();
    if (!input){ if (districtInfo) districtInfo.textContent = 'Введите район или населённый пункт.'; return; }
    const key = input.toLowerCase();
    const data = DISTRICTS[key] || districtFallback(input);
    if (districtInfo) districtInfo.innerHTML = `<strong>${data.title}.</strong> ${data.info}`;
    if (districtMap){
      const q = encodeURIComponent(data.mapQuery);
      districtMap.src = `https://www.google.com/maps?q=${q}&output=embed`;
      districtMap.title = `Карта — ${data.title}`;
    }
  });

  clearDistrict?.addEventListener('click', ()=>{
    if (districtInput) districtInput.value = '';
    if (districtInfo) districtInfo.textContent = '';
    if (districtMap){
      districtMap.src = 'https://www.google.com/maps?q=Saint%20Petersburg&output=embed';
      districtMap.title = 'Карта районов — Санкт-Петербург и ЛО';
    }
  });

  // ——— Email форма (mailto)
  const emailForm = qs('#emailForm');
  const contactStatus = qs('#contactStatus');

  emailForm?.addEventListener('submit', (e)=>{
    e.preventDefault();
    const form = e.currentTarget;
    const hp = form.querySelector('[name="honeypot"]')?.value || '';
    if (hp) return; // антибот
    const name = form.name?.value?.trim() || 'Без имени';
    const email = form.email?.value?.trim() || '';
    const message = form.message?.value?.trim() || '';
    const time = form.preferredTime?.value?.trim() || '';
    if (!email || !message){
      if (contactStatus) contactStatus.textContent = 'Заполните email и сообщение.';
      form.classList.add('shake'); setTimeout(()=>form.classList.remove('shake'), 320);
      return;
    }
    const subject = `Dom Veka: заявка от ${name}`;
    const body = [
      `Имя: ${name}`,
      `Email: ${email}`,
      time ? `Удобное время: ${time}` : '',
      '',
      'Сообщение:',
      message
    ].filter(Boolean).join('\n');
    const link = `mailto:info@domveka.ru?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    if (contactStatus) contactStatus.textContent = 'Откроется почтовый клиент с готовым письмом…';
    location.href = link;
  });

  // ——— Переход по hash
  if (location.hash){
    const target = document.getElementById(location.hash.slice(1));
    target?.scrollIntoView({behavior:'smooth', block:'start'});
    target?.classList.add('shake');
    setTimeout(()=>target?.classList.remove('shake'), 600);
  }
});
</script>

